name: Reusable Slack Bot PR Workflow

on:
  workflow_call:
    inputs:
      repo_name:
        description: 'Repository Name'
        required: true
        type: string
      pr_title:
        description: 'Pull Request Title'
        required: true
        type: string
      pr_url:
        description: 'Pull Request URL'
        required: true
        type: string
    secrets:
      slack_channel_id:
        required: true
      slack_bot_token:
        required: true

jobs:
  reusable-job:
    runs-on: ubuntu-latest
    steps:
      - name: Hello message
        run: |
          echo "Hello, Reuseable Actions, PR!"
          echo "Repository Name: ${{ inputs.repo_name }}"
          echo "Pull Request Title: ${{ inputs.pr_title }}"
          echo "Pull Request URL: ${{ inputs.pr_url }}"
      - name: Extract PR number
        id: extract_pr
        run: echo "pr_number=$(echo '${{ inputs.pr_url }}' | awk -F'/' '{print $NF}')" >> $GITHUB_OUTPUT
      - name: Send Slack notification for dependency PR
        uses: slackapi/slack-github-action@v2.0.0
        with:
          channel: ${{ secrets.slack_channel_id }}
          token: ${{ secrets.slack_bot_token }}
          payload: |
            {
              "text": "Dependabot PR: ${{ inputs.repo_name }}: ${{ inputs.pr_title }}",
              "attachments": [
                {
                  "color": "#FFFFFF",
                  "blocks": [
                    {
                      "type": "section",
                      "text": {
                        "type": "mrkdwn",
                        "text": "*${{ inputs.repo_name }}*"
                      }
                    },
                    {
                      "type": "context",
                      "elements": [
                        {
                          "type": "mrkdwn",
                          "text": "### ${{ inputs.pr_title }}"
                        },
                        {
                          "type": "mrkdwn",
                          "text": "<${{ inputs.pr_url }}|#${{ steps.extract_pr.outputs.pr_number }}>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }